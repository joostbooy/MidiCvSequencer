ARM GAS  /var/folders/84/_x1cyy_j36g486tldtwl37280000gn/T//cc7JUcjw.s 			page 1


   1              		.cpu cortex-m4
   2              		.eabi_attribute 27, 1
   3              		.eabi_attribute 28, 1
   4              		.eabi_attribute 20, 1
   5              		.eabi_attribute 21, 1
   6              		.eabi_attribute 23, 3
   7              		.eabi_attribute 24, 1
   8              		.eabi_attribute 25, 1
   9              		.eabi_attribute 26, 1
  10              		.eabi_attribute 30, 2
  11              		.eabi_attribute 34, 1
  12              		.eabi_attribute 18, 4
  13              		.file	"sdio.cpp"
  14              		.text
  15              	.Ltext0:
  16              		.cfi_sections	.debug_frame
  17              		.section	.text._ZN4Sdio4initEv,"ax",%progbits
  18              		.align	1
  19              		.p2align 2,,3
  20              		.global	_ZN4Sdio4initEv
  21              		.arch armv7e-m
  22              		.syntax unified
  23              		.thumb
  24              		.thumb_func
  25              		.fpu fpv4-sp-d16
  27              	_ZN4Sdio4initEv:
  28              	.LVL0:
  29              	.LFB2010:
  30              		.file 1 "Drivers/sdio.cpp"
   1:Drivers/sdio.cpp **** #include "sdio.h"
   2:Drivers/sdio.cpp **** 
   3:Drivers/sdio.cpp **** Sdio sdio;
   4:Drivers/sdio.cpp **** 
   5:Drivers/sdio.cpp **** void Sdio::init() {
  31              		.loc 1 5 19 view -0
  32              		.cfi_startproc
  33              		@ args = 0, pretend = 0, frame = 24
  34              		@ frame_needed = 0, uses_anonymous_args = 0
   6:Drivers/sdio.cpp **** 	GPIO_InitTypeDef GPIO_InitStruct = {0};
  35              		.loc 1 6 2 view .LVU1
   5:Drivers/sdio.cpp **** 
  36              		.loc 1 5 19 is_stmt 0 view .LVU2
  37 0000 F0B5     		push	{r4, r5, r6, r7, lr}
  38              		.cfi_def_cfa_offset 20
  39              		.cfi_offset 4, -20
  40              		.cfi_offset 5, -16
  41              		.cfi_offset 6, -12
  42              		.cfi_offset 7, -8
  43              		.cfi_offset 14, -4
  44 0002 87B0     		sub	sp, sp, #28
  45              		.cfi_def_cfa_offset 48
  46              		.loc 1 6 19 view .LVU3
  47 0004 0024     		movs	r4, #0
   7:Drivers/sdio.cpp **** 
   8:Drivers/sdio.cpp **** 	//powerOff();
   9:Drivers/sdio.cpp **** 
  10:Drivers/sdio.cpp **** 	/**GPIO Configuration
ARM GAS  /var/folders/84/_x1cyy_j36g486tldtwl37280000gn/T//cc7JUcjw.s 			page 2


  11:Drivers/sdio.cpp **** 	PA8     ------> Card detect
  12:Drivers/sdio.cpp **** 	*/
  13:Drivers/sdio.cpp **** 	GPIO_InitStruct.Pin = GPIO_PIN_8;
  48              		.loc 1 13 22 view .LVU4
  49 0006 4FF48073 		mov	r3, #256
  14:Drivers/sdio.cpp **** 	GPIO_InitStruct.Mode = GPIO_MODE_INPUT;
  15:Drivers/sdio.cpp **** 	GPIO_InitStruct.Pull = GPIO_NOPULL;
  16:Drivers/sdio.cpp **** 	HAL_GPIO_Init(GPIOA, &GPIO_InitStruct);
  50              		.loc 1 16 15 view .LVU5
  51 000a 01A9     		add	r1, sp, #4
  52 000c 1248     		ldr	r0, .L4
  53              	.LVL1:
  13:Drivers/sdio.cpp **** 	GPIO_InitStruct.Mode = GPIO_MODE_INPUT;
  54              		.loc 1 13 22 view .LVU6
  55 000e 0193     		str	r3, [sp, #4]
  14:Drivers/sdio.cpp **** 	GPIO_InitStruct.Mode = GPIO_MODE_INPUT;
  56              		.loc 1 14 2 is_stmt 1 view .LVU7
  15:Drivers/sdio.cpp **** 	HAL_GPIO_Init(GPIOA, &GPIO_InitStruct);
  57              		.loc 1 15 2 view .LVU8
  58              		.loc 1 16 2 view .LVU9
  17:Drivers/sdio.cpp **** 
  18:Drivers/sdio.cpp **** 
  19:Drivers/sdio.cpp **** 	/**SDIO GPIO Configuration
  20:Drivers/sdio.cpp **** 	PC8     ------> SDIO_D0
  21:Drivers/sdio.cpp **** 	PC9     ------> SDIO_D1
  22:Drivers/sdio.cpp **** 	PC10     ------> SDIO_D2
  23:Drivers/sdio.cpp **** 	PC11     ------> SDIO_D3
  24:Drivers/sdio.cpp **** 	PC12     ------> SDIO_CK
  25:Drivers/sdio.cpp **** 	PD2     ------> SDIO_CMD
  26:Drivers/sdio.cpp **** 	*/
  27:Drivers/sdio.cpp **** 	GPIO_InitStruct.Pin = GPIO_PIN_8 | GPIO_PIN_9 | GPIO_PIN_10 | GPIO_PIN_11 | GPIO_PIN_12;
  28:Drivers/sdio.cpp **** 	GPIO_InitStruct.Mode = GPIO_MODE_AF_PP;
  59              		.loc 1 28 23 is_stmt 0 view .LVU10
  60 0010 0227     		movs	r7, #2
  29:Drivers/sdio.cpp **** 	GPIO_InitStruct.Pull = GPIO_NOPULL;
  30:Drivers/sdio.cpp **** 	GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_MEDIUM;
  61              		.loc 1 30 24 view .LVU11
  62 0012 0126     		movs	r6, #1
  31:Drivers/sdio.cpp **** 	GPIO_InitStruct.Alternate = GPIO_AF12_SDIO;
  63              		.loc 1 31 28 view .LVU12
  64 0014 0C25     		movs	r5, #12
   6:Drivers/sdio.cpp **** 
  65              		.loc 1 6 19 view .LVU13
  66 0016 CDE90444 		strd	r4, r4, [sp, #16]
  15:Drivers/sdio.cpp **** 	HAL_GPIO_Init(GPIOA, &GPIO_InitStruct);
  67              		.loc 1 15 23 view .LVU14
  68 001a CDE90244 		strd	r4, r4, [sp, #8]
  16:Drivers/sdio.cpp **** 
  69              		.loc 1 16 15 view .LVU15
  70 001e FFF7FEFF 		bl	HAL_GPIO_Init
  71              	.LVL2:
  27:Drivers/sdio.cpp **** 	GPIO_InitStruct.Mode = GPIO_MODE_AF_PP;
  72              		.loc 1 27 2 is_stmt 1 view .LVU16
  27:Drivers/sdio.cpp **** 	GPIO_InitStruct.Mode = GPIO_MODE_AF_PP;
  73              		.loc 1 27 22 is_stmt 0 view .LVU17
  74 0022 4FF4F852 		mov	r2, #7936
  32:Drivers/sdio.cpp **** 	HAL_GPIO_Init(GPIOC, &GPIO_InitStruct);
ARM GAS  /var/folders/84/_x1cyy_j36g486tldtwl37280000gn/T//cc7JUcjw.s 			page 3


  75              		.loc 1 32 15 view .LVU18
  76 0026 01A9     		add	r1, sp, #4
  77 0028 0C48     		ldr	r0, .L4+4
  29:Drivers/sdio.cpp **** 	GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_MEDIUM;
  78              		.loc 1 29 23 view .LVU19
  79 002a 0394     		str	r4, [sp, #12]
  28:Drivers/sdio.cpp **** 	GPIO_InitStruct.Pull = GPIO_NOPULL;
  80              		.loc 1 28 23 view .LVU20
  81 002c CDE90127 		strd	r2, r7, [sp, #4]
  29:Drivers/sdio.cpp **** 	GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_MEDIUM;
  82              		.loc 1 29 2 is_stmt 1 view .LVU21
  30:Drivers/sdio.cpp **** 	GPIO_InitStruct.Alternate = GPIO_AF12_SDIO;
  83              		.loc 1 30 2 view .LVU22
  31:Drivers/sdio.cpp **** 	HAL_GPIO_Init(GPIOC, &GPIO_InitStruct);
  84              		.loc 1 31 28 is_stmt 0 view .LVU23
  85 0030 CDE90465 		strd	r6, r5, [sp, #16]
  86              		.loc 1 32 2 is_stmt 1 view .LVU24
  87              		.loc 1 32 15 is_stmt 0 view .LVU25
  88 0034 FFF7FEFF 		bl	HAL_GPIO_Init
  89              	.LVL3:
  33:Drivers/sdio.cpp **** 
  34:Drivers/sdio.cpp **** 	GPIO_InitStruct.Pin = GPIO_PIN_2;
  90              		.loc 1 34 2 is_stmt 1 view .LVU26
  91              		.loc 1 34 22 is_stmt 0 view .LVU27
  92 0038 0423     		movs	r3, #4
  35:Drivers/sdio.cpp **** 	GPIO_InitStruct.Mode = GPIO_MODE_AF_PP;
  36:Drivers/sdio.cpp **** 	GPIO_InitStruct.Pull = GPIO_NOPULL;
  37:Drivers/sdio.cpp **** 	GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_MEDIUM;
  38:Drivers/sdio.cpp **** 	GPIO_InitStruct.Alternate = GPIO_AF12_SDIO;
  39:Drivers/sdio.cpp **** 	HAL_GPIO_Init(GPIOD, &GPIO_InitStruct);
  93              		.loc 1 39 15 view .LVU28
  94 003a 01A9     		add	r1, sp, #4
  95 003c 0848     		ldr	r0, .L4+8
  34:Drivers/sdio.cpp **** 	GPIO_InitStruct.Mode = GPIO_MODE_AF_PP;
  96              		.loc 1 34 22 view .LVU29
  97 003e 0193     		str	r3, [sp, #4]
  35:Drivers/sdio.cpp **** 	GPIO_InitStruct.Mode = GPIO_MODE_AF_PP;
  98              		.loc 1 35 2 is_stmt 1 view .LVU30
  36:Drivers/sdio.cpp **** 	GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_MEDIUM;
  99              		.loc 1 36 2 view .LVU31
  37:Drivers/sdio.cpp **** 	GPIO_InitStruct.Alternate = GPIO_AF12_SDIO;
 100              		.loc 1 37 2 view .LVU32
  38:Drivers/sdio.cpp **** 	HAL_GPIO_Init(GPIOD, &GPIO_InitStruct);
 101              		.loc 1 38 2 view .LVU33
 102              		.loc 1 39 2 view .LVU34
  35:Drivers/sdio.cpp **** 	GPIO_InitStruct.Pull = GPIO_NOPULL;
 103              		.loc 1 35 23 is_stmt 0 view .LVU35
 104 0040 CDE90274 		strd	r7, r4, [sp, #8]
  38:Drivers/sdio.cpp **** 	HAL_GPIO_Init(GPIOD, &GPIO_InitStruct);
 105              		.loc 1 38 28 view .LVU36
 106 0044 CDE90465 		strd	r6, r5, [sp, #16]
 107              		.loc 1 39 15 view .LVU37
 108 0048 FFF7FEFF 		bl	HAL_GPIO_Init
 109              	.LVL4:
  40:Drivers/sdio.cpp **** 
  41:Drivers/sdio.cpp **** 	// Enable dma interrupt
  42:Drivers/sdio.cpp **** 	HAL_NVIC_EnableIRQ(DMA2_Stream3_IRQn);
ARM GAS  /var/folders/84/_x1cyy_j36g486tldtwl37280000gn/T//cc7JUcjw.s 			page 4


 110              		.loc 1 42 2 is_stmt 1 view .LVU38
 111              		.loc 1 42 20 is_stmt 0 view .LVU39
 112 004c 3B20     		movs	r0, #59
 113 004e FFF7FEFF 		bl	HAL_NVIC_EnableIRQ
 114              	.LVL5:
  43:Drivers/sdio.cpp **** }
 115              		.loc 1 43 1 view .LVU40
 116 0052 07B0     		add	sp, sp, #28
 117              		.cfi_def_cfa_offset 20
 118              		@ sp needed
 119 0054 F0BD     		pop	{r4, r5, r6, r7, pc}
 120              	.L5:
 121 0056 00BF     		.align	2
 122              	.L4:
 123 0058 00000240 		.word	1073872896
 124 005c 00080240 		.word	1073874944
 125 0060 000C0240 		.word	1073875968
 126              		.cfi_endproc
 127              	.LFE2010:
 129              		.section	.text._ZN4Sdio8init_dmaEmNS_7DmaTypeE,"ax",%progbits
 130              		.align	1
 131              		.p2align 2,,3
 132              		.global	_ZN4Sdio8init_dmaEmNS_7DmaTypeE
 133              		.syntax unified
 134              		.thumb
 135              		.thumb_func
 136              		.fpu fpv4-sp-d16
 138              	_ZN4Sdio8init_dmaEmNS_7DmaTypeE:
 139              	.LVL6:
 140              	.LFB2011:
  44:Drivers/sdio.cpp **** 
  45:Drivers/sdio.cpp **** 
  46:Drivers/sdio.cpp **** // DMA2 steam 3 Channel 4
  47:Drivers/sdio.cpp **** const uint32_t kChannel4				= (4 << 25);
  48:Drivers/sdio.cpp **** const uint32_t kMemoryBurst_inc4		= (1 << 23);
  49:Drivers/sdio.cpp **** const uint32_t kPeripheralBurst_inc4	= (1 << 21);
  50:Drivers/sdio.cpp **** const uint32_t kPriorityVeryHigh		= (3 << 16);
  51:Drivers/sdio.cpp **** const uint32_t kMemorySize_32bit		= (2 << 13);
  52:Drivers/sdio.cpp **** const uint32_t kPeripheralSize_32bit	= (2 << 11);
  53:Drivers/sdio.cpp **** const uint32_t kEnableMemoryIncrement	= (1 << 10);
  54:Drivers/sdio.cpp **** const uint32_t kEnableFifo				= (1 << 8);
  55:Drivers/sdio.cpp **** const uint32_t kMemoryToPeripheral		= (1 << 6);
  56:Drivers/sdio.cpp **** const uint32_t kPeripheralFlowControl	= (1 << 5);
  57:Drivers/sdio.cpp **** const uint32_t kEnable_TC_interupt		= (1 << 4);
  58:Drivers/sdio.cpp **** 
  59:Drivers/sdio.cpp **** void Sdio::init_dma(uint32_t buffer, DmaType dmaType) {
 141              		.loc 1 59 55 is_stmt 1 view -0
 142              		.cfi_startproc
 143              		@ args = 0, pretend = 0, frame = 0
 144              		@ frame_needed = 0, uses_anonymous_args = 0
 145              		@ link register save eliminated.
  60:Drivers/sdio.cpp **** 	DMA2_Stream3->CR &= ~DMA_SxCR_EN;			// disable stream & wait
 146              		.loc 1 60 2 view .LVU42
 147              		.loc 1 60 19 is_stmt 0 view .LVU43
 148 0000 1548     		ldr	r0, .L12
 149              	.LVL7:
 150              		.loc 1 60 19 view .LVU44
ARM GAS  /var/folders/84/_x1cyy_j36g486tldtwl37280000gn/T//cc7JUcjw.s 			page 5


 151 0002 0368     		ldr	r3, [r0]
  59:Drivers/sdio.cpp **** 	DMA2_Stream3->CR &= ~DMA_SxCR_EN;			// disable stream & wait
 152              		.loc 1 59 55 view .LVU45
 153 0004 70B4     		push	{r4, r5, r6}
 154              		.cfi_def_cfa_offset 12
 155              		.cfi_offset 4, -12
 156              		.cfi_offset 5, -8
 157              		.cfi_offset 6, -4
 158              		.loc 1 60 19 view .LVU46
 159 0006 23F00104 		bic	r4, r3, #1
 160 000a 0460     		str	r4, [r0]
 161              	.L7:
  61:Drivers/sdio.cpp **** 	while (DMA2_Stream3->CR & DMA_SxCR_EN) {};
 162              		.loc 1 61 2 is_stmt 1 view .LVU47
 163              		.loc 1 61 28 view .LVU48
 164              		.loc 1 61 23 is_stmt 0 view .LVU49
 165 000c 1248     		ldr	r0, .L12
 166 000e 0568     		ldr	r5, [r0]
 167              		.loc 1 61 28 view .LVU50
 168 0010 15F00103 		ands	r3, r5, #1
 169 0014 FAD1     		bne	.L7
 170              		.loc 1 61 43 is_stmt 1 discriminator 1 view .LVU51
  62:Drivers/sdio.cpp **** 
  63:Drivers/sdio.cpp **** 	uint32_t direction = 0;
 171              		.loc 1 63 2 discriminator 1 view .LVU52
 172              	.LVL8:
  64:Drivers/sdio.cpp **** 	if (dmaType == MEM_TO_SD) {
 173              		.loc 1 64 2 discriminator 1 view .LVU53
 174 0016 114E     		ldr	r6, .L12+4
 175 0018 114C     		ldr	r4, .L12+8
  65:Drivers/sdio.cpp **** 		direction =	kMemoryToPeripheral;
  66:Drivers/sdio.cpp **** 	} else if (dmaType == SD_TO_MEM) {
  67:Drivers/sdio.cpp **** 		direction =	0;
  68:Drivers/sdio.cpp **** 	}
  69:Drivers/sdio.cpp **** 
  70:Drivers/sdio.cpp **** 	DMA2_Stream3->CR = 0;
 176              		.loc 1 70 19 is_stmt 0 discriminator 1 view .LVU54
 177 001a 0360     		str	r3, [r0]
  64:Drivers/sdio.cpp **** 	if (dmaType == MEM_TO_SD) {
 178              		.loc 1 64 2 discriminator 1 view .LVU55
 179 001c 002A     		cmp	r2, #0
 180 001e 0CBF     		ite	eq
 181 0020 3246     		moveq	r2, r6
 182 0022 2246     		movne	r2, r4
 183              	.LVL9:
 184              		.loc 1 70 2 is_stmt 1 discriminator 1 view .LVU56
  71:Drivers/sdio.cpp **** 	DMA2_Stream3->CR = (kChannel4 | kMemoryBurst_inc4 | kPeripheralBurst_inc4 | kPriorityVeryHigh | kM
 185              		.loc 1 71 2 discriminator 1 view .LVU57
 186              		.loc 1 71 19 is_stmt 0 discriminator 1 view .LVU58
 187 0024 0260     		str	r2, [r0]
  72:Drivers/sdio.cpp **** 
  73:Drivers/sdio.cpp **** 	DMA2_Stream3->FCR |= DMA_SxFCR_DMDIS;	// disable direct mode (enables fifo mode)
 188              		.loc 1 73 2 is_stmt 1 discriminator 1 view .LVU59
 189              		.loc 1 73 20 is_stmt 0 discriminator 1 view .LVU60
 190 0026 4269     		ldr	r2, [r0, #20]
  74:Drivers/sdio.cpp **** 	DMA2_Stream3->FCR |= (3 << 0); 			// fifo treshold full
  75:Drivers/sdio.cpp **** 
ARM GAS  /var/folders/84/_x1cyy_j36g486tldtwl37280000gn/T//cc7JUcjw.s 			page 6


  76:Drivers/sdio.cpp **** 	DMA2->LIFCR |= DMA_LIFCR_CTCIF3 | DMA_LIFCR_CHTIF3 | DMA_LIFCR_CTEIF3 | DMA_LIFCR_CDMEIF3 | DMA_LI
 191              		.loc 1 76 14 discriminator 1 view .LVU61
 192 0028 0E4C     		ldr	r4, .L12+12
  77:Drivers/sdio.cpp **** 	DMA2_Stream3->PAR = reinterpret_cast<uint32_t>(&SDIO->FIFO);
 193              		.loc 1 77 20 discriminator 1 view .LVU62
 194 002a 0F4E     		ldr	r6, .L12+16
 195              	.LBB6:
 196              	.LBB7:
 197              		.file 2 "Drivers/sdio.h"
   1:Drivers/sdio.h **** #ifndef Sdio_h
   2:Drivers/sdio.h **** #define Sdio_h
   3:Drivers/sdio.h **** 
   4:Drivers/sdio.h **** #include "stmf4lib.h"
   5:Drivers/sdio.h **** #include "timeOut.h"
   6:Drivers/sdio.h **** #include "debug.h"
   7:Drivers/sdio.h **** 
   8:Drivers/sdio.h **** // Based on:
   9:Drivers/sdio.h **** // https://github.com/westlicht/performer/blob/master/src/platform/stm32/drivers/SdCard.cpp
  10:Drivers/sdio.h **** 
  11:Drivers/sdio.h **** class Sdio {
  12:Drivers/sdio.h **** 
  13:Drivers/sdio.h **** public:
  14:Drivers/sdio.h **** 
  15:Drivers/sdio.h **** 	enum Command {
  16:Drivers/sdio.h **** 		CMD0_SOFT_RESET					= 0,
  17:Drivers/sdio.h **** 		CMD1_INITIALISE					= 1,
  18:Drivers/sdio.h **** 		CMD8_SEND_IF_COND				= 8,	// Interface condition
  19:Drivers/sdio.h **** 		CMD9_READ_CSD_REGISTER			= 9,	// Card specific data
  20:Drivers/sdio.h **** 		CMD10_READ_CID_REGISTER			= 10,	// Card id
  21:Drivers/sdio.h **** 		CMD12_STOP_READ					= 12,
  22:Drivers/sdio.h **** 		ACMD13_SD_STATUS				= 13,
  23:Drivers/sdio.h **** 		CMD16_CHANGE_BLOCK_SIZE			= 16,
  24:Drivers/sdio.h **** 		CMD17_READ_BLOCK				= 17,
  25:Drivers/sdio.h **** 		CMD18_READ_MULTIPLE_BLOCKS		= 18,
  26:Drivers/sdio.h **** 		ACMD23_NUM_OF_BLOCKS			= 23,
  27:Drivers/sdio.h **** 		CMD24_WRITE_BLOCK				= 24,
  28:Drivers/sdio.h **** 		CMD25_WRITE_MULTIPLE_BLOCKS		= 25,
  29:Drivers/sdio.h **** 		CMD32_ERASE_WR_BLK_START_ADDR	= 32,
  30:Drivers/sdio.h **** 		CMD33_ERASE_WR_BLK_END_ADDR		= 33,
  31:Drivers/sdio.h **** 		CMD38_ERASE						= 38,
  32:Drivers/sdio.h **** 		ACMD41_INIT_SDC					= 41,
  33:Drivers/sdio.h **** 		CMD55_APP_COMMAND 				= 55,	// Precedes all app commands
  34:Drivers/sdio.h **** 		CMD58_READ_OCR					= 58	// Operation condition
  35:Drivers/sdio.h **** 	};
  36:Drivers/sdio.h **** 
  37:Drivers/sdio.h **** 	enum Error {
  38:Drivers/sdio.h **** 		Success,
  39:Drivers/sdio.h **** 		InProgress,
  40:Drivers/sdio.h **** 		Timeout,
  41:Drivers/sdio.h **** 		CRCFail,
  42:Drivers/sdio.h **** 		Unknown,
  43:Drivers/sdio.h **** 	};
  44:Drivers/sdio.h **** 
  45:Drivers/sdio.h **** 	void init();
  46:Drivers/sdio.h **** 
  47:Drivers/sdio.h **** 	bool status() {
  48:Drivers/sdio.h **** 		if (initialised_) {
ARM GAS  /var/folders/84/_x1cyy_j36g486tldtwl37280000gn/T//cc7JUcjw.s 			page 7


  49:Drivers/sdio.h **** 			initialised_ = detected();
  50:Drivers/sdio.h **** 		}
  51:Drivers/sdio.h **** 
  52:Drivers/sdio.h **** 		if (initialised_) {
  53:Drivers/sdio.h **** 			initialised_ = waitDataReady();
  54:Drivers/sdio.h **** 		}
  55:Drivers/sdio.h **** 
  56:Drivers/sdio.h **** 		if (!initialised_) {
  57:Drivers/sdio.h **** 			initialised_ = init_card();
  58:Drivers/sdio.h **** 		}
  59:Drivers/sdio.h **** 
  60:Drivers/sdio.h **** 		return initialised_;
  61:Drivers/sdio.h **** 	}
  62:Drivers/sdio.h **** 
  63:Drivers/sdio.h **** 	bool read(uint8_t* buf, uint32_t sector, uint8_t count) {
  64:Drivers/sdio.h **** 		uint8_t *data = buf;
  65:Drivers/sdio.h **** 
  66:Drivers/sdio.h **** 		for (uint32_t i = 0; i < count; ++i) {
  67:Drivers/sdio.h **** 			if (!readBlocks(sector + i, data)) {
  68:Drivers/sdio.h **** 				return false;
  69:Drivers/sdio.h **** 			}
  70:Drivers/sdio.h **** 			data += 512;
  71:Drivers/sdio.h **** 		}
  72:Drivers/sdio.h **** 		return true;
  73:Drivers/sdio.h **** 	}
  74:Drivers/sdio.h **** 
  75:Drivers/sdio.h **** 	bool write(const uint8_t* buf, uint32_t sector, uint8_t count) {
  76:Drivers/sdio.h **** 		const uint8_t *data = buf;
  77:Drivers/sdio.h **** 
  78:Drivers/sdio.h **** 		for (uint32_t i = 0; i < count; ++i) {
  79:Drivers/sdio.h **** 			if (!writeBlocks(sector + i, data)) {
  80:Drivers/sdio.h **** 				return false;
  81:Drivers/sdio.h **** 			}
  82:Drivers/sdio.h **** 			data += 512;
  83:Drivers/sdio.h **** 		}
  84:Drivers/sdio.h **** 		return true;
  85:Drivers/sdio.h **** 	}
  86:Drivers/sdio.h **** 
  87:Drivers/sdio.h **** 	bool initialised() {
  88:Drivers/sdio.h **** 		return initialised_;
  89:Drivers/sdio.h **** 	}
  90:Drivers/sdio.h **** 
  91:Drivers/sdio.h **** 	bool detected() {
  92:Drivers/sdio.h **** 		return !(GPIOA->IDR & GPIO_PIN_8);
  93:Drivers/sdio.h **** 	}
  94:Drivers/sdio.h **** 
  95:Drivers/sdio.h **** 	uint32_t sector_count() {
  96:Drivers/sdio.h **** 		return cardInfo.size;
  97:Drivers/sdio.h **** 	}
  98:Drivers/sdio.h **** 
  99:Drivers/sdio.h **** 	uint32_t sector_size() {
 100:Drivers/sdio.h **** 		return 512;
 101:Drivers/sdio.h **** 	}
 102:Drivers/sdio.h **** 
 103:Drivers/sdio.h **** 	volatile bool dma_busy() {
 104:Drivers/sdio.h **** 		return dma_busy_;
 105:Drivers/sdio.h **** 	}
ARM GAS  /var/folders/84/_x1cyy_j36g486tldtwl37280000gn/T//cc7JUcjw.s 			page 8


 106:Drivers/sdio.h **** 
 107:Drivers/sdio.h **** 	void unlock_dma() {
 108:Drivers/sdio.h **** 		SDIO->DCTRL &= ~SDIO_DCTRL_DMAEN;
 109:Drivers/sdio.h **** 		DMA2_Stream3->CR &= ~DMA_SxCR_EN;
 110:Drivers/sdio.h **** 		dma_busy_ = false;
 111:Drivers/sdio.h **** 	}
 112:Drivers/sdio.h **** 
 113:Drivers/sdio.h **** 	void lock_dma() {
 114:Drivers/sdio.h **** 		dma_busy_ = true;
 198              		.loc 2 114 13 discriminator 1 view .LVU63
 199 002c 0F4D     		ldr	r5, .L12+20
 200              	.LBE7:
 201              	.LBE6:
  73:Drivers/sdio.cpp **** 	DMA2_Stream3->FCR |= (3 << 0); 			// fifo treshold full
 202              		.loc 1 73 20 discriminator 1 view .LVU64
 203 002e 42F00402 		orr	r2, r2, #4
 204 0032 4261     		str	r2, [r0, #20]
  74:Drivers/sdio.cpp **** 
 205              		.loc 1 74 2 is_stmt 1 discriminator 1 view .LVU65
  74:Drivers/sdio.cpp **** 
 206              		.loc 1 74 20 is_stmt 0 discriminator 1 view .LVU66
 207 0034 4269     		ldr	r2, [r0, #20]
 208 0036 42F00302 		orr	r2, r2, #3
 209 003a 4261     		str	r2, [r0, #20]
  76:Drivers/sdio.cpp **** 	DMA2_Stream3->PAR = reinterpret_cast<uint32_t>(&SDIO->FIFO);
 210              		.loc 1 76 2 is_stmt 1 discriminator 1 view .LVU67
  76:Drivers/sdio.cpp **** 	DMA2_Stream3->PAR = reinterpret_cast<uint32_t>(&SDIO->FIFO);
 211              		.loc 1 76 14 is_stmt 0 discriminator 1 view .LVU68
 212 003c A268     		ldr	r2, [r4, #8]
 213 003e 42F07462 		orr	r2, r2, #255852544
 214 0042 A260     		str	r2, [r4, #8]
 215              		.loc 1 77 2 is_stmt 1 discriminator 1 view .LVU69
 216              		.loc 1 77 20 is_stmt 0 discriminator 1 view .LVU70
 217 0044 8660     		str	r6, [r0, #8]
  78:Drivers/sdio.cpp **** 	DMA2_Stream3->M0AR = buffer;
 218              		.loc 1 78 2 is_stmt 1 discriminator 1 view .LVU71
 219              		.loc 1 78 21 is_stmt 0 discriminator 1 view .LVU72
 220 0046 C160     		str	r1, [r0, #12]
  79:Drivers/sdio.cpp **** 	DMA2_Stream3->NDTR = 0;
 221              		.loc 1 79 2 is_stmt 1 discriminator 1 view .LVU73
 222              		.loc 1 79 21 is_stmt 0 discriminator 1 view .LVU74
 223 0048 4360     		str	r3, [r0, #4]
  80:Drivers/sdio.cpp **** 	DMA2_Stream3->CR |= DMA_SxCR_EN;		// enable stream
 224              		.loc 1 80 2 is_stmt 1 discriminator 1 view .LVU75
 225              		.loc 1 80 19 is_stmt 0 discriminator 1 view .LVU76
 226 004a 0168     		ldr	r1, [r0]
 227              	.LVL10:
 228              	.LBB10:
 229              	.LBB8:
 230              		.loc 2 114 13 discriminator 1 view .LVU77
 231 004c 0123     		movs	r3, #1
 232              	.LBE8:
 233              	.LBE10:
 234              		.loc 1 80 19 discriminator 1 view .LVU78
 235 004e 1943     		orrs	r1, r1, r3
 236 0050 0160     		str	r1, [r0]
  81:Drivers/sdio.cpp **** 
ARM GAS  /var/folders/84/_x1cyy_j36g486tldtwl37280000gn/T//cc7JUcjw.s 			page 9


  82:Drivers/sdio.cpp **** 	sdio.lock_dma();
 237              		.loc 1 82 2 is_stmt 1 discriminator 1 view .LVU79
 238              	.LVL11:
 239              	.LBB11:
 240              	.LBI6:
 113:Drivers/sdio.h **** 		dma_busy_ = true;
 241              		.loc 2 113 7 discriminator 1 view .LVU80
 242              	.LBB9:
 243              		.loc 2 114 3 discriminator 1 view .LVU81
 244              		.loc 2 114 13 is_stmt 0 discriminator 1 view .LVU82
 245 0052 AB74     		strb	r3, [r5, #18]
 246              	.LVL12:
 247              		.loc 2 114 13 discriminator 1 view .LVU83
 248              	.LBE9:
 249              	.LBE11:
  83:Drivers/sdio.cpp **** }
 250              		.loc 1 83 1 discriminator 1 view .LVU84
 251 0054 70BC     		pop	{r4, r5, r6}
 252              		.cfi_restore 6
 253              		.cfi_restore 5
 254              		.cfi_restore 4
 255              		.cfi_def_cfa_offset 0
 256 0056 7047     		bx	lr
 257              	.L13:
 258              		.align	2
 259              	.L12:
 260 0058 58640240 		.word	1073898584
 261 005c 7054A308 		.word	144921712
 262 0060 3054A308 		.word	144921648
 263 0064 00640240 		.word	1073898496
 264 0068 802C0140 		.word	1073818752
 265 006c 00000000 		.word	.LANCHOR0
 266              		.cfi_endproc
 267              	.LFE2011:
 269              		.section	.text.DMA2_Stream3_IRQHandler,"ax",%progbits
 270              		.align	1
 271              		.p2align 2,,3
 272              		.global	DMA2_Stream3_IRQHandler
 273              		.syntax unified
 274              		.thumb
 275              		.thumb_func
 276              		.fpu fpv4-sp-d16
 278              	DMA2_Stream3_IRQHandler:
 279              	.LFB2012:
  84:Drivers/sdio.cpp **** 
  85:Drivers/sdio.cpp **** extern "C" {
  86:Drivers/sdio.cpp **** 	void DMA2_Stream3_IRQHandler(void) {
 280              		.loc 1 86 37 is_stmt 1 view -0
 281              		.cfi_startproc
 282              		@ args = 0, pretend = 0, frame = 0
 283              		@ frame_needed = 0, uses_anonymous_args = 0
 284              		@ link register save eliminated.
  87:Drivers/sdio.cpp **** 		uint32_t flags = DMA2->LISR;
 285              		.loc 1 87 3 view .LVU86
 286              		.loc 1 87 26 is_stmt 0 view .LVU87
 287 0000 0A4B     		ldr	r3, .L19
 288 0002 1968     		ldr	r1, [r3]
ARM GAS  /var/folders/84/_x1cyy_j36g486tldtwl37280000gn/T//cc7JUcjw.s 			page 10


 289              	.LVL13:
  88:Drivers/sdio.cpp **** 		DMA2->LIFCR |= DMA_LIFCR_CTCIF3 | DMA_LIFCR_CHTIF3;
 290              		.loc 1 88 3 is_stmt 1 view .LVU88
 291              		.loc 1 88 15 is_stmt 0 view .LVU89
 292 0004 9A68     		ldr	r2, [r3, #8]
 293 0006 42F04060 		orr	r0, r2, #201326592
 294 000a 9860     		str	r0, [r3, #8]
  89:Drivers/sdio.cpp **** 
  90:Drivers/sdio.cpp **** 		if (flags & DMA_LISR_TCIF3) {
 295              		.loc 1 90 3 is_stmt 1 view .LVU90
 296 000c 0B01     		lsls	r3, r1, #4
 297 000e 0CD5     		bpl	.L14
  91:Drivers/sdio.cpp **** 			sdio.unlock_dma();
 298              		.loc 1 91 4 view .LVU91
 299              	.LVL14:
 300              	.LBB12:
 301              	.LBI12:
 107:Drivers/sdio.h **** 		SDIO->DCTRL &= ~SDIO_DCTRL_DMAEN;
 302              		.loc 2 107 7 view .LVU92
 303              	.LBB13:
 108:Drivers/sdio.h **** 		DMA2_Stream3->CR &= ~DMA_SxCR_EN;
 304              		.loc 2 108 3 view .LVU93
 108:Drivers/sdio.h **** 		DMA2_Stream3->CR &= ~DMA_SxCR_EN;
 305              		.loc 2 108 15 is_stmt 0 view .LVU94
 306 0010 0749     		ldr	r1, .L19+4
 307              	.LVL15:
 109:Drivers/sdio.h **** 		dma_busy_ = false;
 308              		.loc 2 109 20 view .LVU95
 309 0012 084A     		ldr	r2, .L19+8
 108:Drivers/sdio.h **** 		DMA2_Stream3->CR &= ~DMA_SxCR_EN;
 310              		.loc 2 108 15 view .LVU96
 311 0014 CB6A     		ldr	r3, [r1, #44]
 110:Drivers/sdio.h **** 	}
 312              		.loc 2 110 13 view .LVU97
 313 0016 0848     		ldr	r0, .L19+12
 108:Drivers/sdio.h **** 		DMA2_Stream3->CR &= ~DMA_SxCR_EN;
 314              		.loc 2 108 15 view .LVU98
 315 0018 23F00803 		bic	r3, r3, #8
 316 001c CB62     		str	r3, [r1, #44]
 109:Drivers/sdio.h **** 		dma_busy_ = false;
 317              		.loc 2 109 3 is_stmt 1 view .LVU99
 109:Drivers/sdio.h **** 		dma_busy_ = false;
 318              		.loc 2 109 20 is_stmt 0 view .LVU100
 319 001e 1368     		ldr	r3, [r2]
 110:Drivers/sdio.h **** 	}
 320              		.loc 2 110 13 view .LVU101
 321 0020 0021     		movs	r1, #0
 109:Drivers/sdio.h **** 		dma_busy_ = false;
 322              		.loc 2 109 20 view .LVU102
 323 0022 23F00103 		bic	r3, r3, #1
 324 0026 1360     		str	r3, [r2]
 110:Drivers/sdio.h **** 	}
 325              		.loc 2 110 3 is_stmt 1 view .LVU103
 110:Drivers/sdio.h **** 	}
 326              		.loc 2 110 13 is_stmt 0 view .LVU104
 327 0028 8174     		strb	r1, [r0, #18]
 328              	.LVL16:
ARM GAS  /var/folders/84/_x1cyy_j36g486tldtwl37280000gn/T//cc7JUcjw.s 			page 11


 329              	.L14:
 110:Drivers/sdio.h **** 	}
 330              		.loc 2 110 13 view .LVU105
 331              	.LBE13:
 332              	.LBE12:
  92:Drivers/sdio.cpp **** 		}
  93:Drivers/sdio.cpp **** 	}
 333              		.loc 1 93 2 view .LVU106
 334 002a 7047     		bx	lr
 335              	.L20:
 336              		.align	2
 337              	.L19:
 338 002c 00640240 		.word	1073898496
 339 0030 002C0140 		.word	1073818624
 340 0034 58640240 		.word	1073898584
 341 0038 00000000 		.word	.LANCHOR0
 342              		.cfi_endproc
 343              	.LFE2012:
 345              		.global	sdio
 346              		.section	.bss.sdio,"aw",%nobits
 347              		.align	2
 348              		.set	.LANCHOR0,. + 0
 351              	sdio:
 352 0000 00000000 		.space	20
 352      00000000 
 352      00000000 
 352      00000000 
 352      00000000 
 353              		.text
 354              	.Letext0:
 355              		.file 3 "/Users/joostbooy/STM32Cube/Repository/STM32Cube_FW_F4_V1.26.1/Drivers/CMSIS/Device/ST/STM
 356              		.file 4 "/usr/local/Caskroom/gcc-arm-embedded/9-2019-q4-major/gcc-arm-none-eabi-9-2019-q4-major/ar
 357              		.file 5 "/usr/local/Caskroom/gcc-arm-embedded/9-2019-q4-major/gcc-arm-none-eabi-9-2019-q4-major/ar
 358              		.file 6 "/usr/local/Caskroom/gcc-arm-embedded/9-2019-q4-major/gcc-arm-none-eabi-9-2019-q4-major/ar
 359              		.file 7 "/Users/joostbooy/STM32Cube/Repository/STM32Cube_FW_F4_V1.26.1/Drivers/CMSIS/Include/core_
 360              		.file 8 "/Users/joostbooy/STM32Cube/Repository/STM32Cube_FW_F4_V1.26.1/Drivers/CMSIS/Device/ST/STM
 361              		.file 9 "/usr/local/Caskroom/gcc-arm-embedded/9-2019-q4-major/gcc-arm-none-eabi-9-2019-q4-major/li
 362              		.file 10 "/Users/joostbooy/STM32Cube/Repository/STM32Cube_FW_F4_V1.26.1/Drivers/STM32F4xx_HAL_Driv
 363              		.file 11 "/Users/joostbooy/STM32Cube/Repository/STM32Cube_FW_F4_V1.26.1/Drivers/STM32F4xx_HAL_Driv
 364              		.file 12 "/usr/local/Caskroom/gcc-arm-embedded/9-2019-q4-major/gcc-arm-none-eabi-9-2019-q4-major/a
 365              		.file 13 "/usr/local/Caskroom/gcc-arm-embedded/9-2019-q4-major/gcc-arm-none-eabi-9-2019-q4-major/a
 366              		.file 14 "/usr/local/Caskroom/gcc-arm-embedded/9-2019-q4-major/gcc-arm-none-eabi-9-2019-q4-major/a
 367              		.file 15 "/usr/local/Caskroom/gcc-arm-embedded/9-2019-q4-major/gcc-arm-none-eabi-9-2019-q4-major/a
 368              		.file 16 "/usr/local/Caskroom/gcc-arm-embedded/9-2019-q4-major/gcc-arm-none-eabi-9-2019-q4-major/a
 369              		.file 17 "/usr/local/Caskroom/gcc-arm-embedded/9-2019-q4-major/gcc-arm-none-eabi-9-2019-q4-major/a
 370              		.file 18 "/usr/local/Caskroom/gcc-arm-embedded/9-2019-q4-major/gcc-arm-none-eabi-9-2019-q4-major/a
 371              		.file 19 "/usr/local/Caskroom/gcc-arm-embedded/9-2019-q4-major/gcc-arm-none-eabi-9-2019-q4-major/a
 372              		.file 20 "/usr/local/Caskroom/gcc-arm-embedded/9-2019-q4-major/gcc-arm-none-eabi-9-2019-q4-major/a
 373              		.file 21 "/usr/local/Caskroom/gcc-arm-embedded/9-2019-q4-major/gcc-arm-none-eabi-9-2019-q4-major/a
 374              		.file 22 "/usr/local/Caskroom/gcc-arm-embedded/9-2019-q4-major/gcc-arm-none-eabi-9-2019-q4-major/a
 375              		.file 23 "/usr/local/Caskroom/gcc-arm-embedded/9-2019-q4-major/gcc-arm-none-eabi-9-2019-q4-major/a
 376              		.file 24 "/usr/local/Caskroom/gcc-arm-embedded/9-2019-q4-major/gcc-arm-none-eabi-9-2019-q4-major/a
 377              		.file 25 "/usr/local/Caskroom/gcc-arm-embedded/9-2019-q4-major/gcc-arm-none-eabi-9-2019-q4-major/a
 378              		.file 26 "/usr/local/Caskroom/gcc-arm-embedded/9-2019-q4-major/gcc-arm-none-eabi-9-2019-q4-major/a
 379              		.file 27 "/usr/local/Caskroom/gcc-arm-embedded/9-2019-q4-major/gcc-arm-none-eabi-9-2019-q4-major/a
 380              		.file 28 "/usr/local/Caskroom/gcc-arm-embedded/9-2019-q4-major/gcc-arm-none-eabi-9-2019-q4-major/a
 381              		.file 29 "/usr/local/Caskroom/gcc-arm-embedded/9-2019-q4-major/gcc-arm-none-eabi-9-2019-q4-major/a
ARM GAS  /var/folders/84/_x1cyy_j36g486tldtwl37280000gn/T//cc7JUcjw.s 			page 12


 382              		.file 30 "/usr/local/Caskroom/gcc-arm-embedded/9-2019-q4-major/gcc-arm-none-eabi-9-2019-q4-major/a
 383              		.file 31 "/usr/local/Caskroom/gcc-arm-embedded/9-2019-q4-major/gcc-arm-none-eabi-9-2019-q4-major/a
 384              		.file 32 "/usr/local/Caskroom/gcc-arm-embedded/9-2019-q4-major/gcc-arm-none-eabi-9-2019-q4-major/a
 385              		.file 33 "/usr/local/Caskroom/gcc-arm-embedded/9-2019-q4-major/gcc-arm-none-eabi-9-2019-q4-major/a
 386              		.file 34 "/usr/local/Caskroom/gcc-arm-embedded/9-2019-q4-major/gcc-arm-none-eabi-9-2019-q4-major/a
 387              		.file 35 "/usr/local/Caskroom/gcc-arm-embedded/9-2019-q4-major/gcc-arm-none-eabi-9-2019-q4-major/a
 388              		.file 36 "/usr/local/Caskroom/gcc-arm-embedded/9-2019-q4-major/gcc-arm-none-eabi-9-2019-q4-major/l
 389              		.file 37 "<built-in>"
 390              		.file 38 "/usr/local/Caskroom/gcc-arm-embedded/9-2019-q4-major/gcc-arm-none-eabi-9-2019-q4-major/a
 391              		.file 39 "/usr/local/Caskroom/gcc-arm-embedded/9-2019-q4-major/gcc-arm-none-eabi-9-2019-q4-major/a
 392              		.file 40 "/usr/local/Caskroom/gcc-arm-embedded/9-2019-q4-major/gcc-arm-none-eabi-9-2019-q4-major/a
 393              		.file 41 "/usr/local/Caskroom/gcc-arm-embedded/9-2019-q4-major/gcc-arm-none-eabi-9-2019-q4-major/a
 394              		.file 42 "/usr/local/Caskroom/gcc-arm-embedded/9-2019-q4-major/gcc-arm-none-eabi-9-2019-q4-major/a
 395              		.file 43 "/usr/local/Caskroom/gcc-arm-embedded/9-2019-q4-major/gcc-arm-none-eabi-9-2019-q4-major/a
 396              		.file 44 "/usr/local/Caskroom/gcc-arm-embedded/9-2019-q4-major/gcc-arm-none-eabi-9-2019-q4-major/a
 397              		.file 45 "/usr/local/Caskroom/gcc-arm-embedded/9-2019-q4-major/gcc-arm-none-eabi-9-2019-q4-major/a
 398              		.file 46 "/usr/local/Caskroom/gcc-arm-embedded/9-2019-q4-major/gcc-arm-none-eabi-9-2019-q4-major/a
 399              		.file 47 "Drivers/micros.h"
 400              		.file 48 "Src/Engine/timeOut.h"
 401              		.file 49 "Drivers/debug.h"
 402              		.file 50 "/Users/joostbooy/STM32Cube/Repository/STM32Cube_FW_F4_V1.26.1/Drivers/STM32F4xx_HAL_Driv
ARM GAS  /var/folders/84/_x1cyy_j36g486tldtwl37280000gn/T//cc7JUcjw.s 			page 13


DEFINED SYMBOLS
                            *ABS*:0000000000000000 sdio.cpp
/var/folders/84/_x1cyy_j36g486tldtwl37280000gn/T//cc7JUcjw.s:18     .text._ZN4Sdio4initEv:0000000000000000 $t
/var/folders/84/_x1cyy_j36g486tldtwl37280000gn/T//cc7JUcjw.s:27     .text._ZN4Sdio4initEv:0000000000000000 _ZN4Sdio4initEv
/var/folders/84/_x1cyy_j36g486tldtwl37280000gn/T//cc7JUcjw.s:123    .text._ZN4Sdio4initEv:0000000000000058 $d
/var/folders/84/_x1cyy_j36g486tldtwl37280000gn/T//cc7JUcjw.s:130    .text._ZN4Sdio8init_dmaEmNS_7DmaTypeE:0000000000000000 $t
/var/folders/84/_x1cyy_j36g486tldtwl37280000gn/T//cc7JUcjw.s:138    .text._ZN4Sdio8init_dmaEmNS_7DmaTypeE:0000000000000000 _ZN4Sdio8init_dmaEmNS_7DmaTypeE
/var/folders/84/_x1cyy_j36g486tldtwl37280000gn/T//cc7JUcjw.s:260    .text._ZN4Sdio8init_dmaEmNS_7DmaTypeE:0000000000000058 $d
/var/folders/84/_x1cyy_j36g486tldtwl37280000gn/T//cc7JUcjw.s:270    .text.DMA2_Stream3_IRQHandler:0000000000000000 $t
/var/folders/84/_x1cyy_j36g486tldtwl37280000gn/T//cc7JUcjw.s:278    .text.DMA2_Stream3_IRQHandler:0000000000000000 DMA2_Stream3_IRQHandler
/var/folders/84/_x1cyy_j36g486tldtwl37280000gn/T//cc7JUcjw.s:338    .text.DMA2_Stream3_IRQHandler:000000000000002c $d
/var/folders/84/_x1cyy_j36g486tldtwl37280000gn/T//cc7JUcjw.s:351    .bss.sdio:0000000000000000 sdio
/var/folders/84/_x1cyy_j36g486tldtwl37280000gn/T//cc7JUcjw.s:347    .bss.sdio:0000000000000000 $d

UNDEFINED SYMBOLS
HAL_GPIO_Init
HAL_NVIC_EnableIRQ
